{% extends "layout.html" %} {% block content %}{{super()}}
<div id="main" class="container-fluid">
    <div id="top" class="row">
        <form method="POST" id="formfiltro" action="/files">
            <div class="col-sm-12">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <h4>Filtrar por número e datas</h4>
                </div>
                <div class="col-sm-3">
                    <label for="numero">Número do contêiner</label>
                </div>
                <div class="col-sm-4">
                    <label for="date">Período de escaneamento da imagem</label>
                </div>
                <div class="col-sm-2">
                    <label for="alerta">Com alerta?</label>
                </div>
                <div class="col-sm-3">
                    Página {{oform.pagina_atual.data}} de {{ npaginas }}
                </div>
            </div>
            <div class="row">
                <div class="form-group">
                    <div class="col-sm-3">
                        <input class="form-control" type="text" name="numero" value="{{oform.numero.data}}" />
                    </div>
                    <div class="col-sm-2">
                        <input class="form-control" type="date" name="start" value="{{oform.start.data}}" />
                    </div>
                    <div class="col-sm-2">
                        <input class="form-control" type="date" name="end" value="{{oform.end.data}}" />
                    </div>
                    <div class="col-sm-1">
                        <input class="form-control" type="checkbox" name="alerta" {% if oform.alerta.data %} checked {% endif %} />
                    </div>
                    <div class="col-sm-1">
                        <input class="btn btn-default btn-info" type="submit" value="Filtrar" />
                    </div>
                    <div class="col-sm-2">
                        <input class="form-control" type="hidden" id="pagina_atual" name="pagina_atual" value="{{oform.pagina_atual.data}}" />
                        <button onclick="next_page(-1)" id="btn_page" type="button" class="btn btn-default btn-info"> < </button>
                        <button onclick="next_page(-10)" id="btn_page" type="button" class="btn btn-default btn-info"> << </button>
                        <button onclick="next_page(10)" id="btn_page" type="button" class="btn btn-default btn-info"> >> </button>
                        <button onclick="next_page(1)" id="btn_page" type="button" class="btn btn-default btn-info"> > </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div class="row">
        <h4>OU Definir filtro personalizado</h4>
        <div id="list" class="row col-sm-6">
            <form id="frmfiltros" class="form-group">
                <div class="form-group col-sm-4">
                    <select class="form-control" name="campos" id="campos">
                        <option value="0">Selecione...</option>
                        {% for campo in campos %}
                        <option value="{{ campo }}">{{ campo }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group col-sm-4">
                    <input id="valor" class="form-control" type="text" placeholder="Valor do parâmetro">
                </div>
                <div class="form-group col-sm-4">
                    <button onclick="adicionar_campo()" id="btn_ok" type="button" class="btn btn-default btn-info">Filtrar</button>
                </div>
            </form>
        </div>
        <div id="list" class="row col-sm-6">
            <div class="table">
                <table class="inlineTable table table-bordered table-hover table-responsive" id="filtros">
                    {% if filtros %} {% for campo, valor in filtros.items() %}
                    <tr>
                        <td>{{campo}}</td>
                        <td>{{valor}}</td>
                        <td align="center">
                            <input type="button" class="btn  btn-danger" value="x" onclick="exclui_campo('{{campo}}')" />
                        </td>
                    </tr>
                    {% endfor %} {% else %}
                    <tr>
                        <td>Sem filtros personalizados.</td>
                    </tr>
                    {% endif %}
                </table>
            </div>
        </div>
    </div>
</div>

<div id="list" class="row">
    &nbsp;
    <div class="col-sm-1">
        &nbsp;
    </div>
    <div class="table table-responsive col-sm-10">
        {# Display a page of todos #}
        <table class="inlineTable table table-striped table-bordered table-hover table-condensed table-responsive">
            <thead>
                <tr>
                    <td>Número informado do Contêiner</td>
                    <td>Nome do Arquivo</td>
                    <td>Data de Escaneamento</td>
                </tr>
            </thead>
            {% for myfile in paginated_files %}
            <tr>
                <td>{{ myfile['numero'] }}</td>
                <td>{{ myfile['filename'] }}</td>
                <td>{{ myfile['dataescaneamento'] }}</td>
                <td><img src="/image/{{ myfile['_id'] }}" height="100" />
                    <img src="/image2/{{ myfile['_id'] }}" height="100" />
                </td>
                <td>
                    <a href="/file/{{ myfile['_id'] }}" target="_BLANK">Ver</a>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
    <div class="col-sm-1">
        &nbsp;
    </div>
</div>
<div id="bottom" class="row">
    AJNA - Receita Federal do Brasil 2017
</div>
</div>
<!-- /#main -->
{% endblock %} {% block scripts %} {{super()}}
<script type="text/javascript">

    function adicionar_campo() {
        var campo = $("#campos").val();
        var valor = $("#valor").val();
        if ((campo != '') && (valor != '')) {
            window.location.assign('/files?campo=' + campo + '&valor=' + valor)
        }
    }

    function exclui_campo(campo) {
        window.location.assign('/files?campo=' + campo)
    }
    function next_page(increment){
        var page = Number($('#pagina_atual').val());
        new_page = page + increment;
        if (new_page <=0) new_page = 1;
        if (new_page > {{npaginas}}) new_page = {{npaginas}};
        $('#pagina_atual').val(new_page);
        form = $('#formfiltro')
        form.submit()
    }

</script> {% endblock %}